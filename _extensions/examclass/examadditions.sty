% This file is used to add additional features to the examclass package.
% First, it adds three new environments to make it easier for users to include content depending on whether answers are being printed or not: opt_notprintanswers, instructions (which is just an alias for opt_notprintanswers), and opt_printanswers.
% Second, it adds a macro called \solutionstitle which can be used to change the title of the document to the original title with "Solutions" appended.
% Third, it adds a new environment called true_false_questions which is used to create true/false questions.
% Fourth, it adds a new environment called multicolcheckboxes which is used to create multiple choice questions with multiple columns of checkboxes.
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{examadditions}[2023/05/24 Additional features for the exam class]
\RequirePackage{environ}
\RequirePackage{ifthen}



% ---------- Conditional Question Title ---------- %

\makeatletter
\newif\ifIsTitledQuestion
\def\ifIsTitledQuestion{%
  \ifnum\pdfstrcmp{\thequestiontitle}{\thequestion}=0 %
    \expandafter\@secondoftwo
  \else
    \expandafter\@firstoftwo
  \fi
  {\IsTitledQuestiontrue}%
  {\IsTitledQuestionfalse}%
  \ifIsTitledQuestion
}
\makeatother

\makeatletter
\newcommand{\conditionalQuestionTitle}{%
  \ifIsTitledQuestion
    \thequestiontitle
  \else
    \@empty
  \fi
}
\makeatother

% ---------- Multicol Checkboxes Environment ---------- %
\RequirePackage{multicol}

\newenvironment{multicolcheckboxes}{%
\begin{checkboxes}\begin{multicols}{2}%
}{%
\end{multicols}\end{checkboxes}%
}

% ---------- True/False Environment ---------- %


\newenvironment{true_false_questions}[1][]{%
    \vspace{0.5em}
    \begin{tabular}[t]{p{0.7\textwidth}cc}
    \textbf{#1} & \textbf{True} & \textbf{False} \\
    \hline
    \noalign{\vspace{2pt}}
}{%
    \end{tabular}
}

\newcommand{\tfitem}[2]{%
    #1 & \TrueFalseChoice{#2} & \TrueFalseChoice{\ifstrequal{#2}{T}{F}{T}} \\[2pt]
}

\makeatletter
\newcommand*{\TrueFalseChoice}[1]{%
    \ifprintanswers
        \ifthenelse{\equal{#1}{T}}{%
        {\color@begingroup\CorrectChoice@Emphasis\checked@char
        \color@endgroup}%
        }{%
        \checkbox@char
        }%
    \else
    \checkbox@char
    \fi
}
\makeatother

% ---------- opt_notprintanswers Environment ---------- %

% The opt_notprintanswers environment is used to print content that should only be printed if printanswers is false. It can be used to print instructions for the students, for example.

\NewEnviron{opt_notprintanswers}{
  \ifprintanswers
  \else
    \BODY
  \fi
}


% ---------- Instructions Environment ---------- %

% The instructions environment is just a shortcut for the opt_notprintanswers environment.

\NewEnviron{instructions}{
  \ifprintanswers
  \else
    \BODY
  \fi
}

% ---------- opt_printanswers Environment ---------- %

% The opt_printanswers environment is used to print content that should only be printed if printanswers is true. It can be used to print the correct answers to the questions, for example.

\NewEnviron{opt_printanswers}{
  \ifprintanswers
    \BODY
  \fi
}





% ---------- Solutions Title ---------- %
% Macro to change the title of the document to the original title with "Solutions" appended

\newcommand{\solutionstitle}{%
  \let\oldtitle\title
  \renewcommand{\title}[1]{%
    \oldtitle{##1 Solutions}%
  }%
}

\endinput